-- LocalScript Fly Custom untuk Mobile/Android
-- Taruh di StarterPlayer > StarterPlayerScripts
-- Fitur: GUI draggable, TextBox untuk speed (max 99999), up/down buttons, toggle fly, invisible, minimize/close

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local GuiService = game:GetService("GuiService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local rootPart = character:WaitForChild("HumanoidRootPart")

local flying = false
local invisible = false
local speed = 50  -- Default speed
local bodyVelocity = nil
local bodyGyro = nil

-- Buat GUI (ScreenGui)
local screenGui = Instance.new("ScreenGui")
screenGui.Parent = player:WaitForChild("PlayerGui")
screenGui.ResetOnSpawn = false  -- Biar gak hilang saat respawn

-- Frame utama (draggable)
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 200, 0, 250)
mainFrame.Position = UDim2.new(0, 10, 0, 10)  -- Kiri atas default
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.BackgroundTransparency = 0.2
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

-- Buat draggable (support touch)
local dragging = false
local dragInput, dragStart, startPos
mainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = mainFrame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)
UserInputService.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch and dragging then
        local delta = input.Position - dragStart
        mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

-- Tombol Minimize (kecilkan frame)
local minimizeButton = Instance.new("TextButton")
minimizeButton.Size = UDim2.new(0, 30, 0, 30)
minimizeButton.Position = UDim2.new(1, -60, 0, 0)
minimizeButton.Text = "-"
minimizeButton.Parent = mainFrame
minimizeButton.MouseButton1Click:Connect(function()
    mainFrame.Size = UDim2.new(0, 200, 0, 30)  -- Minimize
end)

-- Tombol Close (X)
local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0, 30, 0, 30)
closeButton.Position = UDim2.new(1, -30, 0, 0)
closeButton.Text = "X"
closeButton.Parent = mainFrame
closeButton.MouseButton1Click:Connect(function()
    screenGui.Enabled = false  -- Sembunyikan GUI
end)

-- Tombol Toggle Fly
local flyButton = Instance.new("TextButton")
flyButton.Size = UDim2.new(1, 0, 0, 40)
flyButton.Position = UDim2.new(0, 0, 0, 30)
flyButton.Text = "Fly: Off"
flyButton.Parent = mainFrame
flyButton.MouseButton1Click:Connect(function()
    if flying then
        stopFly()
        flyButton.Text = "Fly: Off"
    else
        startFly()
        flyButton.Text = "Fly: On"
    end
end)

-- TextBox untuk Speed
local speedLabel = Instance.new("TextLabel")
speedLabel.Size = UDim2.new(1, 0, 0, 30)
speedLabel.Position = UDim2.new(0, 0, 0, 70)
speedLabel.Text = "Speed: 50"
speedLabel.Parent = mainFrame

local speedBox = Instance.new("TextBox")
speedBox.Size = UDim2.new(1, 0, 0, 30)
speedBox.Position = UDim2.new(0, 0, 0, 100)
speedBox.Text = "50"
speedBox.Parent = mainFrame
speedBox.FocusLost:Connect(function()
    local newSpeed = tonumber(speedBox.Text)
    if newSpeed and newSpeed >= 20 and newSpeed <= 99999 then
        speed = newSpeed
        speedLabel.Text = "Speed: " .. speed
    else
        speedBox.Text = tostring(speed)  -- Revert ke speed sebelumnya kalo invalid
    end
end)

-- Tombol Up
local upButton = Instance.new("TextButton")
upButton.Size = UDim2.new(0.5, 0, 0, 40)
upButton.Position = UDim2.new(0, 0, 0, 130)
upButton.Text = "Up"
upButton.Parent = mainFrame
local upPressed = false
upButton.InputBegan:Connect(function(input) if input.UserInputType == Enum.UserInputType.Touch then upPressed = true end end)
upButton.InputEnded:Connect(function(input) if input.UserInputType == Enum.UserInputType.Touch then upPressed = false end end)

-- Tombol Down
local downButton = Instance.new("TextButton")
downButton.Size = UDim2.new(0.5, 0, 0, 40)
downButton.Position = UDim2.new(0.5, 0, 0, 130)
downButton.Text = "Down"
downButton.Parent = mainFrame
local downPressed = false
downButton.InputBegan:Connect(function(input) if input.UserInputType == Enum.UserInputType.Touch then downPressed = true end end)
downButton.InputEnded:Connect(function(input) if input.UserInputType == Enum.UserInputType.Touch then downPressed = false end end)

-- Toggle Invisible
local invisibleButton = Instance.new("TextButton")
invisibleButton.Size = UDim2.new(1, 0, 0, 40)
invisibleButton.Position = UDim2.new(0, 0, 0, 170)
invisibleButton.Text = "Invisible: Off"
invisibleButton.Parent = mainFrame
invisibleButton.MouseButton1Click:Connect(function()
    invisible = not invisible
    invisibleButton.Text = "Invisible: " .. (invisible and "On" or "Off")
    setInvisible(invisible)
end)

local function setInvisible(state)
    for _, part in pairs(character:GetChildren()) do
        if part:IsA("BasePart") then
            part.Transparency = state and 1 or 0
        end
    end
end

local function startFly()
    if flying then return end
    flying = true
    humanoid.PlatformStand = true
    
    bodyVelocity = Instance.new("BodyVelocity")
    bodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
    bodyVelocity.Velocity = Vector3.new(0, 0, 0)
    bodyVelocity.Parent = rootPart
    
    bodyGyro = Instance.new("BodyGyro")
    bodyGyro.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)
    bodyGyro.CFrame = rootPart.CFrame
    bodyGyro.Parent = rootPart
    
    -- Loop update
    local connection
    connection = RunService.Heartbeat:Connect(function()
        if not flying then
            connection:Disconnect()
            return
        end
        
        local camera = workspace.CurrentCamera
        local moveVector = humanoid.MoveDirection  -- Joystick mobile
        
        local velocity = camera.CFrame:VectorToWorldSpace(moveVector) * speed
        
        -- Up/Down dari tombol
        if upPressed then
            velocity = velocity + Vector3.new(0, speed, 0)
        elseif downPressed then
            velocity = velocity + Vector3.new(0, -speed, 0)
        end
        
        -- Keyboard fallback (buat PC test)
        if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
            velocity = velocity + Vector3.new(0, speed, 0)
        elseif UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) then
            velocity = velocity + Vector3.new(0, -speed, 0)
        end
        
        bodyVelocity.Velocity = velocity
        bodyGyro.CFrame = camera.CFrame
    end)
    
    -- Animasi masuk (smooth)
    TweenService:Create(rootPart, TweenInfo.new(0.5), {CFrame = rootPart.CFrame + Vector3.new(0, 5, 0)}):Play()
end

local function stopFly()
    if not flying then return end
    flying = false
    humanoid.PlatformStand = false
    
    if bodyVelocity then bodyVelocity:Destroy() bodyVelocity = nil end
    if bodyGyro then bodyGyro:Destroy() bodyGyro = nil end
    
    -- Animasi keluar
    TweenService:Create(rootPart, TweenInfo.new(0.5), {CFrame = rootPart.CFrame - Vector3.new(0, 5, 0)}):Play()
end

-- Handle respawn
player.CharacterAdded:Connect(function(newCharacter)
    character = newCharacter
    humanoid = character:WaitForChild("Humanoid")
    rootPart = character:WaitForChild("HumanoidRootPart")
    if flying then startFly() end
    setInvisible(invisible)  -- Restore invisible state
end)

-- Tampilkan GUI
screenGui.Enabled = true
