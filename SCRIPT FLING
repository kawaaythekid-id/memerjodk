-- LocalScript di StarterPlayerScripts

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local rootPart = character:WaitForChild("HumanoidRootPart")
local Debris = game:GetService("Debris")

-- Default
local flingEnabled = false
local flingPower = 5000
local maxSafeVelocity = 500000  -- batas aman untuk physics
local debounceTime = 0.3
local lastFling = 0

-- GUI Setup minimalis
local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
screenGui.Name = "FlingGUI"

local frame = Instance.new("Frame", screenGui)
frame.Size = UDim2.new(0, 240, 0, 120)
frame.Position = UDim2.new(0, 20, 0, 50)
frame.BackgroundColor3 = Color3.fromRGB(60,60,60)
frame.Active = true
frame.Draggable = true

-- Tombol Enable/Disable
local toggleButton = Instance.new("TextButton", frame)
toggleButton.Size = UDim2.new(1, -20, 0, 50)
toggleButton.Position = UDim2.new(0, 10, 0, 10)
toggleButton.Text = "Enable Fling"
toggleButton.TextColor3 = Color3.new(1,1,1)
toggleButton.BackgroundColor3 = Color3.fromRGB(100,200,100)
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.TextSize = 20

toggleButton.MouseButton1Click:Connect(function()
    flingEnabled = not flingEnabled
    toggleButton.Text = flingEnabled and "Disable Fling" or "Enable Fling"
    toggleButton.BackgroundColor3 = flingEnabled and Color3.fromRGB(200,100,100) or Color3.fromRGB(100,200,100)
end)

-- Textbox untuk atur kekuatan fling
local powerBox = Instance.new("TextBox", frame)
powerBox.Size = UDim2.new(1, -20, 0, 40)
powerBox.Position = UDim2.new(0, 10, 0, 70)
powerBox.PlaceholderText = "Masukkan kekuatan fling"
powerBox.Text = tostring(flingPower)
powerBox.ClearTextOnFocus = false
powerBox.TextColor3 = Color3.new(0,0,0)
powerBox.BackgroundColor3 = Color3.fromRGB(220,220,220)
powerBox.Font = Enum.Font.SourceSansBold
powerBox.TextSize = 18

-- Update kekuatan dari textbox (tanpa batas maksimal)
powerBox.FocusLost:Connect(function()
    local val = tonumber(powerBox.Text)
    if val and val >= 1 then
        flingPower = val
    else
        powerBox.Text = tostring(flingPower)
    end
end)

-- Fungsi fling aman
local function fling(otherPlayer)
    if flingEnabled and otherPlayer and otherPlayer.Character and otherPlayer.Character:FindFirstChild("HumanoidRootPart") then
        local now = tick()
        if now - lastFling < debounceTime then return end
        lastFling = now

        local direction = (otherPlayer.Character.HumanoidRootPart.Position - rootPart.Position).unit
        local velocityMagnitude = math.min(flingPower, maxSafeVelocity)
        
        local bv = Instance.new("BodyVelocity")
        bv.Velocity = direction * velocityMagnitude
        bv.MaxForce = Vector3.new(1e7, 1e7, 1e7)
        bv.Parent = otherPlayer.Character.HumanoidRootPart
        Debris:AddItem(bv, 0.2)
    end
end

-- Deteksi sentuhan
rootPart.Touched:Connect(function(hit)
    local otherPlayer = Players:GetPlayerFromCharacter(hit.Parent)
    if otherPlayer and otherPlayer ~= player then
        fling(otherPlayer)
    end
end)
