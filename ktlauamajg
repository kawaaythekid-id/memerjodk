-- LocalScript: Tangga Stabil (Client Only) + Radius Manual + Auto-Scan
local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")
local runService = game:GetService("RunService")

-- GUI
local ScreenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
ScreenGui.Name = "LadderFixGUI"

-- Tombol toggle
local Button = Instance.new("TextButton", ScreenGui)
Button.Size = UDim2.new(0, 220, 0, 50)
Button.Position = UDim2.new(0.5, -110, 0.75, 0)
Button.Text = "Stabilkan Tangga (Client)"
Button.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
Button.TextColor3 = Color3.fromRGB(255,255,255)
Button.TextScaled = true
Button.Font = Enum.Font.SourceSansBold
Button.Draggable = true

-- Input radius
local TextBox = Instance.new("TextBox", ScreenGui)
TextBox.Size = UDim2.new(0, 220, 0, 40)
TextBox.Position = UDim2.new(0.5, -110, 0.85, 0)
TextBox.PlaceholderText = "Masukkan Radius (default 40)"
TextBox.Text = ""
TextBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
TextBox.TextColor3 = Color3.fromRGB(255,255,255)
TextBox.TextScaled = true
TextBox.Font = Enum.Font.SourceSansBold
TextBox.ClearTextOnFocus = true

-- Variabel
local isStabil = false
local ladderParts = {}
local originalCFrames = {}
local detectRadius = 40
local autoScanTime = 5 -- tiap 5 detik cari ulang tangga

-- Cari tangga
local function findLadders()
	ladderParts = {}
	originalCFrames = {}

	for _, obj in pairs(workspace:GetDescendants()) do
		if obj:IsA("BasePart") and obj.Name:lower():find("ladder") then
			if (obj.Position - hrp.Position).Magnitude < detectRadius then
				table.insert(ladderParts, obj)
				originalCFrames[obj] = obj.CFrame
			end
		end
	end
end

-- Stabilkan tangga di layar client
local function stabilize()
	findLadders()
	
	-- Kunci posisi tangga tiap frame
	runService.RenderStepped:Connect(function()
		if isStabil then
			for _, part in ipairs(ladderParts) do
				if part and part.Parent then
					part.CFrame = originalCFrames[part] or part.CFrame
					part.Velocity = Vector3.new(0,0,0)
					part.RotVelocity = Vector3.new(0,0,0)
				end
			end
		end
	end)

	-- Auto-scan ulang setiap beberapa detik
	task.spawn(function()
		while true do
			task.wait(autoScanTime)
			if isStabil then
				findLadders()
			end
		end
	end)
end

-- Toggle tombol
Button.MouseButton1Click:Connect(function()
	isStabil = not isStabil
	if isStabil then
		Button.Text = "Kembalikan Tangga"
		Button.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
		stabilize()
		game:GetService("StarterGui"):SetCore("ChatMakeSystemMessage", {
			Text = "[LadderFix] Tangga terlihat stabil (client only). Radius = "..detectRadius,
			Color = Color3.fromRGB(0,255,0)
		})
	else
		Button.Text = "Stabilkan Tangga (Client)"
		Button.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
		game:GetService("StarterGui"):SetCore("ChatMakeSystemMessage", {
			Text = "[LadderFix] Tangga kembali normal (ikut server).",
			Color = Color3.fromRGB(255,255,0)
		})
	end
end)

-- Atur radius dari TextBox
TextBox.FocusLost:Connect(function(enterPressed)
	if enterPressed then
		local num = tonumber(TextBox.Text)
		if num and num > 0 then
			detectRadius = num
			game:GetService("StarterGui"):SetCore("ChatMakeSystemMessage", {
				Text = "[LadderFix] Radius deteksi diubah ke "..detectRadius.." stud.",
				Color = Color3.fromRGB(0,200,255)
			})
			if isStabil then
				findLadders() -- refresh langsung biar efek terasa
			end
		else
			game:GetService("StarterGui"):SetCore("ChatMakeSystemMessage", {
				Text = "[LadderFix] Input tidak valid, radius tetap "..detectRadius,
				Color = Color3.fromRGB(255,0,0)
			})
		end
	end
end)
