-- LocalScript Stop Tangga Goyang (Anchor semua Part dalam Model + Debug Message)
local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

-- GUI
local ScreenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
ScreenGui.Name = "LadderFixGUI"

local Button = Instance.new("TextButton", ScreenGui)
Button.Size = UDim2.new(0, 220, 0, 50)
Button.Position = UDim2.new(0.5, -110, 0.85, 0)
Button.Text = "Stop Ladder Shake"
Button.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
Button.TextColor3 = Color3.fromRGB(255,255,255)
Button.TextScaled = true
Button.Font = Enum.Font.SourceSansBold
Button.AutoButtonColor = true
Button.Active = true
Button.Draggable = true -- Bisa digeser di Android

-- Variabel
local isStopped = false
local stoppedModels = {}

-- Fungsi untuk menulis pesan debug ke chat
local function debugMessage(msg, color)
	game:GetService("StarterGui"):SetCore("ChatMakeSystemMessage", {
		Text = "[LadderFix] " .. msg,
		Color = color or Color3.fromRGB(0,255,0),
		Font = Enum.Font.SourceSansBold,
		FontSize = Enum.FontSize.Size24
	})
	print("[LadderFix] " .. msg)
end

-- Fungsi Anchor semua Part dalam Model
local function anchorModel(model, state)
	for _, obj in pairs(model:GetDescendants()) do
		if obj:IsA("BasePart") then
			obj.Anchored = state
		end
	end
end

-- Fungsi aktifkan
local function stopLadder()
	if isStopped then return end
	isStopped = true
	Button.Text = "Enable Shake"
	Button.BackgroundColor3 = Color3.fromRGB(200, 50, 50)

	local found = 0

	-- Cari Model/Part bernama "ladder" dekat player
	for _, obj in pairs(workspace:GetDescendants()) do
		if obj:IsA("Model") and obj.Name:lower():find("ladder") then
			if obj.PrimaryPart and (obj.PrimaryPart.Position - hrp.Position).Magnitude < 20 then
				anchorModel(obj, true)
				table.insert(stoppedModels, obj)
				found += 1
			end
		elseif obj:IsA("BasePart") and obj.Name:lower():find("ladder") then
			if (obj.Position - hrp.Position).Magnitude < 20 then
				obj.Anchored = true
				table.insert(stoppedModels, obj)
				found += 1
			end
		end
	end

	if found > 0 then
		debugMessage("Tangga berhasil dihentikan ("..found.." part/model).", Color3.fromRGB(0,255,0))
	else
		debugMessage("Tidak ada tangga ditemukan di dekatmu.", Color3.fromRGB(255,0,0))
	end
end

-- Fungsi nonaktifkan
local function enableShake()
	if not isStopped then return end
	isStopped = false
	Button.Text = "Stop Ladder Shake"
	Button.BackgroundColor3 = Color3.fromRGB(50, 200, 50)

	local restored = 0

	for _, obj in ipairs(stoppedModels) do
		if obj and obj.Parent then
			if obj:IsA("Model") then
				anchorModel(obj, false)
				restored += 1
			elseif obj:IsA("BasePart") then
				obj.Anchored = false
				restored += 1
			end
		end
	end
	stoppedModels = {}

	if restored > 0 then
		debugMessage("Tangga dikembalikan normal ("..restored.." part/model).", Color3.fromRGB(255,255,0))
	else
		debugMessage("Tidak ada tangga untuk dikembalikan.", Color3.fromRGB(255,0,0))
	end
end

-- Toggle manual lewat tombol
Button.MouseButton1Click:Connect(function()
	if isStopped then
		enableShake()
	else
		stopLadder()
	end
end)
