-- LocalScript Stop Tangga Goyang (tetap bisa dipanjat)
-- Taruh di StarterPlayerScripts
local player = game.Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

-- GUI
local ScreenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
ScreenGui.Name = "LadderFixGUI"

local Button = Instance.new("TextButton", ScreenGui)
Button.Size = UDim2.new(0, 220, 0, 50)
Button.Position = UDim2.new(0.5, -110, 0.85, 0)
Button.Text = "Stop Ladder Shake"
Button.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
Button.TextColor3 = Color3.fromRGB(255,255,255)
Button.TextScaled = true
Button.Font = Enum.Font.SourceSansBold
Button.AutoButtonColor = true
Button.Active = true
Button.Draggable = true -- Bisa digeser di Android

-- Variabel
local isStopped = false
local stoppedParts = {}

-- Fungsi aktifkan
local function stopLadder()
	if isStopped then return end
	isStopped = true
	Button.Text = "Enable Shake"
	Button.BackgroundColor3 = Color3.fromRGB(200, 50, 50)

	-- Cari tangga di dekat player (radius 20 stud)
	for _, obj in pairs(workspace:GetDescendants()) do
		if obj:IsA("Part") and obj.Name:lower():find("ladder") then
			if (obj.Position - hrp.Position).Magnitude < 20 then
				obj.Anchored = true -- Hentikan goyang
				table.insert(stoppedParts, obj)
			end
		end
	end
end

-- Fungsi nonaktifkan
local function enableShake()
	if not isStopped then return end
	isStopped = false
	Button.Text = "Stop Ladder Shake"
	Button.BackgroundColor3 = Color3.fromRGB(50, 200, 50)

	-- Kembalikan tangga
	for _, part in ipairs(stoppedParts) do
		if part and part.Parent then
			part.Anchored = false
		end
	end
	stoppedParts = {}
end

-- Toggle manual lewat tombol
Button.MouseButton1Click:Connect(function()
	if isStopped then
		enableShake()
	else
		stopLadder()
	end
end)

-- Auto deteksi tangga (opsional)
task.spawn(function()
	while true do
		task.wait(1) -- cek tiap 1 detik
		local nearLadder = false

		for _, obj in pairs(workspace:GetDescendants()) do
			if obj:IsA("Part") and obj.Name:lower():find("ladder") then
				if (obj.Position - hrp.Position).Magnitude < 20 then
					nearLadder = true
					break
				end
			end
		end

		if nearLadder and not isStopped then
			stopLadder()
		elseif not nearLadder and isStopped then
			enableShake()
		end
	end
end)
