-- Dragable Mini GUI + WalkSpeed Enable + Smooth WallWalk
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")
local workspace = game:GetService("Workspace")

local function setupCharacter(char)
    local humanoid = char:WaitForChild("Humanoid")
    local rootPart = char:WaitForChild("HumanoidRootPart")

    -- ===== ScreenGui =====
    local guiName = "DragMiniGUI_"..tostring(player.UserId)
    local screenGui = playerGui:FindFirstChild(guiName) or Instance.new("ScreenGui")
    screenGui.Name = guiName
    screenGui.ResetOnSpawn = false
    screenGui.Parent = playerGui

    -- ===== Draggable Frame =====
    local frame = screenGui:FindFirstChild("Frame") or Instance.new("Frame")
    frame.Size = UDim2.new(0, 200, 0, 110)
    frame.Position = UDim2.new(0, 10, 0, 10)
    frame.BackgroundColor3 = Color3.fromRGB(50,50,50)
    frame.BorderSizePixel = 0
    frame.Parent = screenGui

    -- Drag logic
    local dragging = false
    local dragInput, mousePos, framePos
    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            mousePos = input.Position
            framePos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)

    RunService.RenderStepped:Connect(function()
        if dragging and dragInput then
            local delta = dragInput.Position - mousePos
            frame.Position = UDim2.new(framePos.X.Scale, framePos.X.Offset + delta.X, framePos.Y.Scale, framePos.Y.Offset + delta.Y)
        end
    end)

    -- ===== WalkSpeed Slider =====
    local sliderBg = frame:FindFirstChild("SliderBg") or Instance.new("Frame")
    sliderBg.Name = "SliderBg"
    sliderBg.Size = UDim2.new(1, -20, 0, 15)
    sliderBg.Position = UDim2.new(0, 10, 0, 10)
    sliderBg.BackgroundColor3 = Color3.fromRGB(100,100,100)
    sliderBg.Parent = frame

    local handle = sliderBg:FindFirstChild("Handle") or Instance.new("Frame")
    handle.Name = "Handle"
    handle.Size = UDim2.new(0, 15, 1, 0)
    handle.Position = UDim2.new(0,0,0,0)
    handle.BackgroundColor3 = Color3.fromRGB(255,0,0)
    handle.Parent = sliderBg

    local speedText = sliderBg:FindFirstChild("SpeedText") or Instance.new("TextLabel")
    speedText.Name = "SpeedText"
    speedText.Size = UDim2.new(1,0,0,15)
    speedText.Position = UDim2.new(0,0,0,-20)
    speedText.BackgroundTransparency = 1
    speedText.TextColor3 = Color3.fromRGB(255,255,255)
    speedText.Font = Enum.Font.SourceSans
    speedText.TextSize = 14
    speedText.Text = "Speed: 16"
    speedText.Parent = sliderBg

    local draggingSlider = false
    local walkSpeedEnabled = true

    local function setWalkSpeed(x)
        if walkSpeedEnabled then
            local relativeX = math.clamp(x / sliderBg.AbsoluteSize.X, 0, 1)
            local speed = math.floor(1 + relativeX * 29)
            humanoid.WalkSpeed = speed
            speedText.Text = "Speed: "..speed
            handle.Position = UDim2.new(relativeX,0,0,0)
        end
    end

    handle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then draggingSlider = true end
    end)
    handle.InputEnded:Connect(function() draggingSlider=false end)
    sliderBg.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
            setWalkSpeed(input.Position.X - sliderBg.AbsolutePosition.X)
            draggingSlider = true
        end
    end)
    sliderBg.InputEnded:Connect(function() draggingSlider=false end)
    sliderBg.InputChanged:Connect(function(input)
        if draggingSlider and (input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseMovement) then
            setWalkSpeed(input.Position.X - sliderBg.AbsolutePosition.X)
        end
    end)

    -- WalkSpeed Enable/Disable button
    local wsBtn = frame:FindFirstChild("WSBtn") or Instance.new("TextButton")
    wsBtn.Name = "WSBtn"
    wsBtn.Size = UDim2.new(0,80,0,25)
    wsBtn.Position = UDim2.new(0,10,0,35)
    wsBtn.BackgroundColor3 = Color3.fromRGB(0,0,150)
    wsBtn.TextColor3 = Color3.fromRGB(255,255,255)
    wsBtn.Font = Enum.Font.SourceSansBold
    wsBtn.TextSize = 14
    wsBtn.Text = "WS Enabled"
    wsBtn.Parent = frame

    wsBtn.MouseButton1Click:Connect(function()
        walkSpeedEnabled = not walkSpeedEnabled
        wsBtn.Text = walkSpeedEnabled and "WS Enabled" or "WS Disabled"
    end)

    screenGui.SetWalkSpeed = function(speed)
        speed = math.clamp(speed,1,30)
        local relativeX = (speed-1)/29
        humanoid.WalkSpeed = walkSpeedEnabled and speed or humanoid.WalkSpeed
        handle.Position = UDim2.new(relativeX,0,0,0)
        speedText.Text = "Speed: "..speed
    end

    -- ===== WallWalk Button =====
    local walkBtn = frame:FindFirstChild("WalkBtn") or Instance.new("TextButton")
    walkBtn.Name = "WalkBtn"
    walkBtn.Size = UDim2.new(0,80,0,25)
    walkBtn.Position = UDim2.new(0,110,0,35)
    walkBtn.BackgroundColor3 = Color3.fromRGB(0,150,0)
    walkBtn.TextColor3 = Color3.fromRGB(255,255,255)
    walkBtn.Font = Enum.Font.SourceSansBold
    walkBtn.TextSize = 14
    walkBtn.Text = "WallWalk Off"
    walkBtn.Parent = frame

    local walking = false
    walkBtn.MouseButton1Click:Connect(function()
        walking = not walking
        walkBtn.Text = walking and "WallWalk On" or "WallWalk Off"
    end)

    -- ===== Smooth WallWalk Logic =====
    RunService.RenderStepped:Connect(function()
        if walking then
            local cam = workspace.CurrentCamera
            local dir = Vector3.new(cam.CFrame.LookVector.X,0,cam.CFrame.LookVector.Z).Unit
            local params = RaycastParams.new()
            params.FilterDescendantsInstances = {char}
            params.FilterType = Enum.RaycastFilterType.Blacklist

            local ray = workspace:Raycast(rootPart.Position, dir*3, params)
            if ray then
                local wallPos = ray.Position
                local newCFrame = CFrame.new(wallPos + Vector3.new(0,1,0), wallPos + dir)
                rootPart.CFrame = rootPart.CFrame:Lerp(newCFrame, 0.2)
            else
                rootPart.Velocity = dir*(walkSpeedEnabled and humanoid.WalkSpeed or 16)
            end
        end
    end)
end

-- Setup pertama
setupCharacter(player.Character or player.CharacterAdded:Wait())

-- Respawn handler
player.CharacterAdded:Connect(setupCharacter)
