-- LocalScript: Ultimate Player Enhancer Compact v1
-- Compact GUI, semua fitur tetap aktif
-- Tempatkan di StarterPlayerScripts

local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local RunService = game:GetService("RunService")

-- ===== Variabel Fitur =====
local DefaultWalkSpeed = 16
local WalkSpeed = 50
local WalkSpeedEnabled = false
local InfinityJumpEnabled = true
local FullBrightEnabled = true
local NoClipEnabled = false
local AutoHealEnabled = false
local GuiVisible = true

local DefaultLighting = {
    Brightness = Lighting.Brightness,
    ClockTime = Lighting.ClockTime,
    FogEnd = Lighting.FogEnd,
    GlobalShadows = Lighting.GlobalShadows
}

-- ===== GUI =====
if PlayerGui:FindFirstChild("UltimateGUI") then
    PlayerGui.UltimateGUI:Destroy()
end

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "UltimateGUI"
ScreenGui.Parent = PlayerGui

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 150, 0, 220) -- compact
Frame.Position = UDim2.new(0.05, 0, 0.05, 0)
Frame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
Frame.BorderSizePixel = 0
Frame.Parent = ScreenGui

local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Size = UDim2.new(0, 40, 0, 25)
MinimizeButton.Position = UDim2.new(1, -45, 0, 5)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(200, 200, 200)
MinimizeButton.TextColor3 = Color3.fromRGB(0,0,0)
MinimizeButton.Text = "-"
MinimizeButton.Parent = Frame

-- Fungsi buat tombol
local function CreateButton(name, yPos)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0, 130, 0, 30)
    btn.Position = UDim2.new(0.5, -65, 0, yPos)
    btn.BackgroundColor3 = Color3.fromRGB(255,0,0)
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.Text = name..": OFF"
    btn.Parent = Frame
    return btn
end

local WalkSpeedButton = CreateButton("WalkSpeed", 40)
local SpeedLabel = Instance.new("TextLabel")
SpeedLabel.Size = UDim2.new(0,130,0,20)
SpeedLabel.Position = UDim2.new(0.5,-65,0,75)
SpeedLabel.BackgroundTransparency = 1
SpeedLabel.TextColor3 = Color3.fromRGB(255,255,255)
SpeedLabel.Text = "Speed: "..WalkSpeed
SpeedLabel.Parent = Frame

local InfinityJumpButton = CreateButton("Infinity Jump", 100)
local FullBrightButton = CreateButton("Full Bright", 135)
local NoClipButton = CreateButton("No Clip", 170)
local AutoHealButton = CreateButton("AutoHeal", 205)

-- ===== Variabel karakter =====
local Humanoid
local Character = Player.Character

local function UpdateCharacterRefs(char)
    Character = char
    Humanoid = char:WaitForChild("Humanoid")
end

-- ===== Fungsi update tombol =====
local function UpdateButtonColor(button, enabled)
    button.BackgroundColor3 = enabled and Color3.fromRGB(0,255,0) or Color3.fromRGB(255,0,0)
    button.Text = button.Text:match("^(.-):") .. ": " .. (enabled and "ON" or "OFF")
end

-- ===== Fitur =====
local AutoHealConnection

local function SetWalkSpeed(enabled)
    if Humanoid then
        Humanoid.WalkSpeed = enabled and WalkSpeed or DefaultWalkSpeed
    end
    UpdateButtonColor(WalkSpeedButton, enabled)
end

local function SetInfinityJump(enabled)
    InfinityJumpEnabled = enabled
    UpdateButtonColor(InfinityJumpButton, enabled)
end

local function SetFullBright(enabled)
    if enabled then
        Lighting.Brightness = 2
        Lighting.ClockTime = 14
        Lighting.FogEnd = 100000
        Lighting.GlobalShadows = false
    else
        Lighting.Brightness = DefaultLighting.Brightness
        Lighting.ClockTime = DefaultLighting.ClockTime
        Lighting.FogEnd = DefaultLighting.FogEnd
        Lighting.GlobalShadows = DefaultLighting.GlobalShadows
    end
    UpdateButtonColor(FullBrightButton, enabled)
end

local function SetNoClip(enabled)
    NoClipEnabled = enabled
    UpdateButtonColor(NoClipButton, enabled)
end

local function SetAutoHeal(enabled)
    AutoHealEnabled = enabled
    UpdateButtonColor(AutoHealButton, enabled)
    if AutoHealConnection then AutoHealConnection:Disconnect() end
    if enabled and Character and Humanoid then
        AutoHealConnection = RunService.RenderStepped:Connect(function()
            if Character and Humanoid then
                Humanoid.Health = Humanoid.MaxHealth
            end
        end)
    end
end

local function ToggleGUI()
    GuiVisible = not GuiVisible
    Frame.Visible = GuiVisible
end

-- ===== Tombol Event =====
WalkSpeedButton.MouseButton1Click:Connect(function()
    WalkSpeedEnabled = not WalkSpeedEnabled
    SetWalkSpeed(WalkSpeedEnabled)
end)

InfinityJumpButton.MouseButton1Click:Connect(function()
    SetInfinityJump(not InfinityJumpEnabled)
end)

FullBrightButton.MouseButton1Click:Connect(function()
    SetFullBright(not FullBrightEnabled)
end)

NoClipButton.MouseButton1Click:Connect(function()
    SetNoClip(not NoClipEnabled)
end)

AutoHealButton.MouseButton1Click:Connect(function()
    SetAutoHeal(not AutoHealEnabled)
end)

MinimizeButton.MouseButton1Click:Connect(ToggleGUI)

-- ===== Infinity Jump =====
UserInputService.JumpRequest:Connect(function()
    if InfinityJumpEnabled and Humanoid then
        Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
    end
end)

-- ===== No Clip =====
RunService.Stepped:Connect(function()
    if NoClipEnabled and Character then
        for _, part in pairs(Character:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    end
end)

-- ===== Respawn handling =====
Player.CharacterAdded:Connect(function(char)
    UpdateCharacterRefs(char)
    SetWalkSpeed(WalkSpeedEnabled)
    SetFullBright(FullBrightEnabled)
    if AutoHealEnabled then SetAutoHeal(true) end
end)

-- ===== Drag GUI =====
local dragging = false
local dragInput
local dragStart
local startPos

local function update(input)
    local delta = input.Position - dragStart
    Frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

Frame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = Frame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
            end
        end)
    end
end)

Frame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then
        update(input)
    end
end)

-- ===== Inisialisasi =====
UpdateCharacterRefs(Player.Character)
SetWalkSpeed(WalkSpeedEnabled)
SetInfinityJump(InfinityJumpEnabled)
SetFullBright(FullBrightEnabled)
SetNoClip(NoClipEnabled)
SetAutoHeal(AutoHealEnabled)
