-- Ultimate Mobile GUI with Drag & Minimize (LocalScript)
-- Tempatkan di StarterPlayerScripts

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local Player = Players.LocalPlayer

-- ===== Variabel =====
local WalkOnAirEnabled = false
local moveDirection = Vector3.new(0,0,0)
local verticalDirection = 0
local WalkSpeed = 16
local FullBrightEnabled = false
local InfinityJumpEnabled = true

-- Simpan pengaturan asli Lighting
local OriginalLighting = {
    Brightness = Lighting.Brightness,
    ClockTime = Lighting.ClockTime,
    FogEnd = Lighting.FogEnd,
    GlobalShadows = Lighting.GlobalShadows
}

-- ===== GUI =====
local function createGUI()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "UltimateCompactGUI"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = Player:WaitForChild("PlayerGui")

    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0,200,0,300)
    frame.Position = UDim2.new(0,20,0,20)
    frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
    frame.Parent = screenGui

    local title = Instance.new("TextLabel")
    title.Text = "Ultimate Compact GUI"
    title.Size = UDim2.new(1,0,0,25)
    title.BackgroundTransparency = 1
    title.TextColor3 = Color3.fromRGB(255,255,255)
    title.Font = Enum.Font.GothamBold
    title.TextSize = 16
    title.Parent = frame

    -- ===== Tombol Minimize =====
    local btnMinimize = Instance.new("TextButton")
    btnMinimize.Text = "_"
    btnMinimize.Size = UDim2.new(0,25,0,25)
    btnMinimize.Position = UDim2.new(1,-30,0,0)
    btnMinimize.BackgroundColor3 = Color3.fromRGB(50,50,50)
    btnMinimize.TextColor3 = Color3.fromRGB(255,255,255)
    btnMinimize.Font = Enum.Font.GothamBold
    btnMinimize.TextSize = 18
    btnMinimize.Parent = frame

    local minimized = false
    btnMinimize.MouseButton1Click:Connect(function()
        minimized = not minimized
        for _,v in pairs(frame:GetChildren()) do
            if v:IsA("GuiObject") and v ~= title and v ~= btnMinimize then
                v.Visible = not minimized
            end
        end
        frame.Size = minimized and UDim2.new(0,200,0,30) or UDim2.new(0,200,0,300)
    end)

    -- ===== WalkSpeed =====
    local speedInput = Instance.new("TextBox")
    speedInput.PlaceholderText = "WalkSpeed 1-25"
    speedInput.Size = UDim2.new(1,-20,0,25)
    speedInput.Position = UDim2.new(0,10,0,35)
    speedInput.BackgroundColor3 = Color3.fromRGB(50,50,50)
    speedInput.TextColor3 = Color3.fromRGB(255,255,255)
    speedInput.Font = Enum.Font.Gotham
    speedInput.TextSize = 16
    speedInput.Parent = frame

    local enableSpeed = Instance.new("TextButton")
    enableSpeed.Text = "Set WalkSpeed"
    enableSpeed.Size = UDim2.new(1,-20,0,25)
    enableSpeed.Position = UDim2.new(0,10,0,65)
    enableSpeed.BackgroundColor3 = Color3.fromRGB(70,70,70)
    enableSpeed.TextColor3 = Color3.fromRGB(255,255,255)
    enableSpeed.Font = Enum.Font.GothamBold
    enableSpeed.TextSize = 16
    enableSpeed.Parent = frame

    enableSpeed.MouseButton1Click:Connect(function()
        local val = tonumber(speedInput.Text)
        if val and val >=1 and val <=25 then
            WalkSpeed = val
        else
            warn("Masukkan angka antara 1-25!")
        end
    end)

    -- ===== Walk On Air toggle =====
    local toggleAir = Instance.new("TextButton")
    toggleAir.Text = "Enable Walk On Air"
    toggleAir.Size = UDim2.new(1,-20,0,30)
    toggleAir.Position = UDim2.new(0,10,0,95)
    toggleAir.BackgroundColor3 = Color3.fromRGB(0,0,0)
    toggleAir.TextColor3 = Color3.fromRGB(255,255,255)
    toggleAir.Font = Enum.Font.GothamBold
    toggleAir.TextSize = 16
    toggleAir.Parent = frame

    toggleAir.MouseButton1Click:Connect(function()
        WalkOnAirEnabled = not WalkOnAirEnabled
        toggleAir.Text = WalkOnAirEnabled and "Disable Walk On Air" or "Enable Walk On Air"
    end)

    -- ===== Full Bright toggle =====
    local btnBright = Instance.new("TextButton")
    btnBright.Text = "Enable Full Bright"
    btnBright.Size = UDim2.new(1,-20,0,30)
    btnBright.Position = UDim2.new(0,10,0,130)
    btnBright.BackgroundColor3 = Color3.fromRGB(0,0,0)
    btnBright.TextColor3 = Color3.fromRGB(255,255,255)
    btnBright.Font = Enum.Font.GothamBold
    btnBright.TextSize = 16
    btnBright.Parent = frame

    btnBright.MouseButton1Click:Connect(function()
        if FullBrightEnabled then
            FullBrightEnabled = false
            Lighting.Brightness = OriginalLighting.Brightness
            Lighting.ClockTime = OriginalLighting.ClockTime
            Lighting.FogEnd = OriginalLighting.FogEnd
            Lighting.GlobalShadows = OriginalLighting.GlobalShadows
            btnBright.Text = "Enable Full Bright"
        else
            FullBrightEnabled = true
            Lighting.Brightness = 2
            Lighting.ClockTime = 14
            Lighting.FogEnd = 100000
            Lighting.GlobalShadows = false
            btnBright.Text = "Disable Full Bright"
        end
    end)

    -- ===== Tombol arah Walk On Air =====
    local function createButton(text,pos)
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(0,40,0,40)
        btn.Position = pos
        btn.BackgroundTransparency = 0.5
        btn.BackgroundColor3 = Color3.fromRGB(0,0,0)
        btn.TextColor3 = Color3.fromRGB(255,255,255)
        btn.Font = Enum.Font.GothamBold
        btn.TextSize = 20
        btn.Text = text
        btn.Parent = screenGui
        return btn
    end

    local btnUp = createButton("▲", UDim2.new(0.85,0,0.7,0))
    local btnDown = createButton("▼", UDim2.new(0.85,0,0.8,0))
    local btnLeft = createButton("◀", UDim2.new(0.8,0,0.75,0))
    local btnRight = createButton("▶", UDim2.new(0.9,0,0.75,0))
    local btnRise = createButton("⬆", UDim2.new(0.05,0,0.7,0))
    local btnFall = createButton("⬇", UDim2.new(0.05,0,0.8,0))

    local function setupButton(btn,dir)
        btn.MouseButton1Down:Connect(function()
            if dir.Y ~= 0 then
                verticalDirection = dir.Y
            else
                moveDirection = dir
            end
        end)
        btn.MouseButton1Up:Connect(function()
            if dir.Y ~= 0 then
                verticalDirection = 0
            else
                moveDirection = Vector3.new(0,0,0)
            end
        end)
    end

    setupButton(btnUp, Vector3.new(0,0,-1))
    setupButton(btnDown, Vector3.new(0,0,1))
    setupButton(btnLeft, Vector3.new(-1,0,0))
    setupButton(btnRight, Vector3.new(1,0,0))
    setupButton(btnRise, Vector3.new(0,5,0))
    setupButton(btnFall, Vector3.new(0,-5,0))

    -- ===== Drag GUI =====
    local dragging, dragInput, dragStart, startPos
    title.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    title.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
end

-- Buat GUI pertama kali
createGUI()

-- ===== Loop utama =====
RunService.RenderStepped:Connect(function(dt)
    local char = Player.Character
    if char then
        local humanoid = char:FindFirstChild("Humanoid")
        local root = char:FindFirstChild("HumanoidRootPart")
        if humanoid and root then
            humanoid.WalkSpeed = WalkSpeed
            if WalkOnAirEnabled then
                humanoid.PlatformStand = true
                local cam = workspace.CurrentCamera.CFrame
                local move = (cam.RightVector*moveDirection.X + cam.LookVector*moveDirection.Z)
                move = Vector3.new(move.X, verticalDirection, move.Z)
                if move.Magnitude > 0 then
                    root.Velocity = move.Unit * 50
                else
                    root.Velocity = Vector3.new(0, verticalDirection,0)
                end
            else
                humanoid.PlatformStand = false
            end
        end
    end
end)

-- ===== Infinity Jump =====
UserInputService.JumpRequest:Connect(function()
    if InfinityJumpEnabled then
        local char = Player.Character
        if char then
            local humanoid = char:FindFirstChild("Humanoid")
            if humanoid then
                humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
            end
        end
    end
end)

-- ===== Respawn: pastikan GUI tetap ada =====
Player.CharacterAdded:Connect(function()
    wait(0.1)
    if not Player:FindFirstChild("PlayerGui"):FindFirstChild("UltimateCompactGUI") then
        createGUI()
    end
end)