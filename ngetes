-- LocalScript di StarterPlayerScripts
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Workspace = game:GetService("Workspace")

local targetDistance = 5

local EnabledGather = false
local EnabledESP = false
local ESPs = {}

-- GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 220, 0, 180)
Frame.Position = UDim2.new(0.7, 0, 0.1, 0)
Frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
Frame.BorderSizePixel = 0
Frame.Parent = ScreenGui

local function createButton(text, pos, callback)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0, 200, 0, 40)
    btn.Position = pos
    btn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.SourceSansBold
    btn.TextSize = 18
    btn.Text = text
    btn.Parent = Frame
    btn.MouseButton1Click:Connect(callback)
    return btn
end

-- Tombol Gather ON/OFF
local gatherBtn = createButton("Gather: OFF", UDim2.new(0,10,0,10), function()
    EnabledGather = not EnabledGather
    gatherBtn.Text = EnabledGather and "Gather: ON (Teleport sekali, bisa hit)" or "Gather: OFF (Players bebas)"
    
    if EnabledGather then
        -- teleport sekali semua pemain ketika tombol diaktifkan
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local hrp = player.Character.HumanoidRootPart
                local localHRP = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                if localHRP then
                    hrp.CFrame = localHRP.CFrame * CFrame.new(math.random(-targetDistance,targetDistance), 0, math.random(-targetDistance,targetDistance))
                end
            end
        end
    end
end)

-- Tombol ESP ON/OFF
local espBtn = createButton("ESP: OFF", UDim2.new(0,10,0,60), function()
    EnabledESP = not EnabledESP
    espBtn.Text = EnabledESP and "ESP: ON" or "ESP: OFF"
end)

-- Tombol Minimize
local minimizeBtn = createButton("Minimize", UDim2.new(0,10,0,110), function()
    Frame.Visible = false
    local restoreBtn = Instance.new("TextButton")
    restoreBtn.Size = UDim2.new(0, 80, 0, 30)
    restoreBtn.Position = UDim2.new(0.9, 0, 0.02, 0)
    restoreBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
    restoreBtn.TextColor3 = Color3.fromRGB(255,255,255)
    restoreBtn.Font = Enum.Font.SourceSansBold
    restoreBtn.TextSize = 16
    restoreBtn.Text = "Restore"
    restoreBtn.Parent = ScreenGui
    restoreBtn.MouseButton1Click:Connect(function()
        Frame.Visible = true
        restoreBtn:Destroy()
    end)
end)

-- Tombol Close
local closeBtn = createButton("Close", UDim2.new(0,10,0,150), function()
    ScreenGui:Destroy()
end)

-- Fungsi buat ESP
local function createESP(player)
    if ESPs[player] then return end
    local box = Instance.new("BoxHandleAdornment")
    box.Adornee = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    box.Color3 = Color3.fromRGB(255,0,0)
    box.Transparency = 0.5
    box.Size = Vector3.new(2,5,1)
    box.AlwaysOnTop = true
    box.ZIndex = 10
    box.Parent = workspace
    ESPs[player] = box
end

-- Hapus ESP ketika pemain keluar
Players.PlayerRemoving:Connect(function(player)
    if ESPs[player] then
        ESPs[player]:Destroy()
        ESPs[player] = nil
    end
end)

-- Update ESP setiap frame
RunService.RenderStepped:Connect(function()
    if EnabledESP then
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                createESP(player)
            end
        end
    else
        for _, box in pairs(ESPs) do
            box:Destroy()
        end
        ESPs = {}
    end
end)
