-- LocalScript di StarterPlayerScripts
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local targetDistance = 5

-- State
local EnabledGather = false
local EnabledESP = false
local ESPs = {}

-- GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 220, 0, 180)
Frame.Position = UDim2.new(0.7, 0, 0.1, 0)
Frame.BackgroundColor3 = Color3.fromRGB(30,30,30)
Frame.BorderSizePixel = 0
Frame.Parent = ScreenGui

-- Function buat tombol
local function createButton(text, pos, callback)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0, 200, 0, 40)
    btn.Position = pos
    btn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.SourceSansBold
    btn.TextSize = 18
    btn.Text = text
    btn.Parent = Frame
    btn.MouseButton1Click:Connect(callback)
    return btn
end

-- Tombol On/Off Kumpulkan Pemain
local gatherBtn = createButton("Gather: OFF", UDim2.new(0,10,0,10), function()
    EnabledGather = not EnabledGather
    gatherBtn.Text = EnabledGather and "Gather: ON" or "Gather: OFF"
end)

-- Tombol On/Off ESP
local espBtn = createButton("ESP: OFF", UDim2.new(0,10,0,60), function()
    EnabledESP = not EnabledESP
    espBtn.Text = EnabledESP and "ESP: ON" or "ESP: OFF"
end)

-- Tombol Minimize
local minimizeBtn = createButton("Minimize", UDim2.new(0,10,0,110), function()
    Frame.Visible = false
    -- Tombol kecil muncul di pojok untuk restore
    local restoreBtn = Instance.new("TextButton")
    restoreBtn.Size = UDim2.new(0, 80, 0, 30)
    restoreBtn.Position = UDim2.new(0.9, 0, 0.02, 0)
    restoreBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
    restoreBtn.TextColor3 = Color3.fromRGB(255,255,255)
    restoreBtn.Font = Enum.Font.SourceSansBold
    restoreBtn.TextSize = 16
    restoreBtn.Text = "Restore"
    restoreBtn.Parent = ScreenGui
    restoreBtn.MouseButton1Click:Connect(function()
        Frame.Visible = true
        restoreBtn:Destroy()
    end)
end)

-- Tombol Hapus/X
local closeBtn = createButton("Close", UDim2.new(0,10,0,150), function()
    ScreenGui:Destroy()
end)

-- Fungsi kumpulkan pemain
local function gatherPlayers()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local hrp = player.Character.HumanoidRootPart
            local localHRP = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
            if localHRP then
                hrp.CFrame = localHRP.CFrame * CFrame.new(math.random(-targetDistance,targetDistance),0,math.random(-targetDistance,targetDistance))
            end
        end
    end
end

-- Fungsi buat ESP
local function createESP(player)
    if ESPs[player] then return end
    local box = Instance.new("BoxHandleAdornment")
    box.Adornee = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    box.Color3 = Color3.fromRGB(255,0,0)
    box.Transparency = 0.5
    box.Size = Vector3.new(2,5,1)
    box.AlwaysOnTop = true
    box.ZIndex = 10
    box.Parent = workspace
    ESPs[player] = box
end

-- Hapus ESP ketika pemain keluar
Players.PlayerRemoving:Connect(function(player)
    if ESPs[player] then
        ESPs[player]:Destroy()
        ESPs[player] = nil
    end
end)

-- Update ESP setiap frame
local function updateESP()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            if EnabledESP then
                createESP(player)
            elseif ESPs[player] then
                ESPs[player]:Destroy()
                ESPs[player] = nil
            end
        end
    end
end

-- Loop utama
RunService.RenderStepped:Connect(function()
    if EnabledGather then
        gatherPlayers()
    end
    updateESP()
end)
